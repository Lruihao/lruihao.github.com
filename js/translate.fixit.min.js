(()=>{var r=!0,o=[],g=[],c=[],h=["Lruihao"],u=["chinese_simplified","chinese_traditional"],d="client.edge",m=[];var f=["header-title","language-switch","post-author","powered","author","typeit","katex","katex-display"],L=["repo-url","netease-music","comment-163"],w=["Hugo","FixIt","Lruihao","CC BY-NC-SA","RSS"],l=class{constructor(){this.service=d,this.languages=u,this.ignoreClass=[...f,...L,...o],this.ignoreID=g,this.ignoreTag=c,this.ignoreText=[...w,...h],this.detectLocalLanguage=r,this.isMobile=fixit.util.isMobile(),this.afterExecuteEvents=new Set,this.lang={...this.getTypesLang()},this.supportLanguages={"client.edge":translate.service.edge.language.json,"translate.service":m},this.hugoLangCodes=window.ATConfig.hugoLangCodes,this.hugoLangMap=window.ATConfig.hugoLangMap,this.dom={}}getLangNameById(t){return this.supportLanguages[this.service]?.find(e=>e.id===t)?.name}getLangCodeById(t){return Object.keys(translate.util.browserLanguage).find(e=>translate.util.browserLanguage[e]===t)}getLangIdByCode(t){return translate.util.browserLanguage[t]}getTypesLang(){return{current:translate.language.getCurrent(),local:window.ATConfig.local||translate.language.getLocal(),query:window.location.search.split("lang=")[1],browser:""}}toggleVisibility(t,e){t.classList.toggle("d-none",!e),t.setAttribute("aria-hidden",!e)}toggleMenuActive(t){Array.from(this.dom.switchMenu.childNodes).filter(e=>e.classList.contains("active")).forEach(e=>{e.classList.remove("active")}),t.classList.add("active")}handleDesktop(){if(this.dom.switchDesktop=document.querySelector("#header-desktop .language-switch.auto"),!this.dom.switchDesktop)return;this.dom.switchMenu=this.dom.switchDesktop.querySelector(".sub-menu"),this.dom.localItem&&this.dom.switchMenu.insertBefore(this.dom.localItem,this.dom.switchMenu.querySelector(".menu-item-divider").nextSibling),this.#e(),this.#t();let t=this.dom.switchDesktop.previousElementSibling;t.classList.contains("language-switch")&&this.toggleVisibility(t,!1),this.toggleVisibility(this.dom.switchDesktop,!0),this.afterExecuteEvents.add(()=>{this.lang={...this.getTypesLang()};let{current:e,local:a,query:s}=this.getTypesLang();this.lang={...this.lang,current:e,query:s},(e!==a||s)&&this.toggleMenuActive(document.querySelector(`.menu-link[data-lang="${e}"]`).parentElement)})}#e(){let t=Array.from(this.dom.switchMenu.childNodes).filter(e=>e.dataset.type==="artificial");fixit.util.forEach(t,e=>{if(e.classList.contains("active")&&!e.children[0].getAttribute("title")){let a=this.getLangNameById(this.lang.local);e.children[0].setAttribute("title",a),e.children[0].insertAdjacentText("beforeend",a)}e.addEventListener("click",a=>{translate.language.clearCacheLanguage()})})}#t(){let t=Array.from(this.dom.switchMenu.childNodes).filter(e=>e.dataset.type==="machine");fixit.util.forEach(t,e=>{let a=e.children[0].dataset.lang,s=this.getLangNameById(a),i=this.getLangCodeById(a);if(this.service==="client.edge"&&!s){this.toggleVisibility(e,!1);return}if(this.hugoLangCodes.includes(i)||a==this.lang.local){this.toggleVisibility(e,!1);return}e.addEventListener("click",b=>{window.history.pushState({},"",`?lang=${a}`),this.toggleMenuActive(e),translate.changeLanguage(a)})})}handleMobile(){this.dom.switchMobile=document.querySelector("#header-mobile .language-switch.auto"),this.dom.switchMobile&&(this.#a(),this.afterExecuteEvents.add(()=>{this.dom.selectEl=this.dom.switchMobile.querySelector("select"),this.dom.selectEl.classList.add("language-select"),this.#s(),this.#i();let{current:t,local:e,query:a}=this.getTypesLang();this.lang={...this.lang,current:t,query:a},(t!==e||a)&&(this.dom.selectEl.value=t),this.toggleVisibility(this.dom.switchMobile,!0)}))}#a(){translate.selectLanguageTag.selectOnChange=t=>{let e=t.target.value;t.target.options[t.target.selectedIndex].dataset.type==="artificial"?(translate.language.clearCacheLanguage(),window.location=e):(window.history.pushState({},"",`?lang=${e}`),translate.changeLanguage(e))}}#s(){fixit.util.forEach(this.dom.selectEl.querySelectorAll("option"),t=>{t.dataset.type="machine",t.innerText=`\u{1F916} ${t.innerText}`;let e=this.getLangCodeById(t.value);(this.hugoLangCodes.includes(e)||t.value==this.lang.local)&&t.parentElement.removeChild(t)})}#i(){let t=this.dom.switchMobile.previousElementSibling;if(this.hugoLangCodes.length>1){fixit.util.forEach(t.querySelectorAll("option"),i=>{if(!i.getAttribute("value"))return i.parentElement.removeChild(i);i.dataset.type="artificial",i.innerText=`\u{1F464} ${i.innerText}`,i.disabled&&i.removeAttribute("disabled")}),this.dom.selectEl.prepend(...t.querySelectorAll("option:not([selected])")),this.dom.selectEl.prepend(t.querySelector("option[selected]")),this.toggleVisibility(t,!1);return}let e=this.dom.switchMobile.querySelector('[role="button"]'),a=this.getLangNameById(this.lang.local);e.dataset.current||(e.dataset.current=a,e.insertAdjacentText("afterbegin",a));let s=document.createElement("option");s.selected=!0,s.dataset.type="artificial",s.value=window.location.pathname,s.innerText=`\u{1F464} ${a}`,this.dom.selectEl.prepend(s),this.toggleVisibility(t,!1)}handle(){return this.isMobile?this.handleMobile():this.handleDesktop(),this}setup(){return translate.ignore.id.push(...this.ignoreID),translate.ignore.class.push(...this.ignoreClass),translate.ignore.tag.push(...this.ignoreTag),translate.ignore.text.push(...this.ignoreText),translate.service.use(this.service),translate.language.setLocal(this.lang.local),translate.language.setUrlParamControl("lang"),translate.listener.start(),translate.selectLanguageTag.show=this.isMobile,translate.selectLanguageTag.languages=this.languages.join(","),this}execute(){translate.execute(),this.afterExecuteEvents.forEach(t=>{t()})}async getBrowserLanguage(){this.lang.browser=translate.util.browserDefaultLanguage();let t=!0;return this.lang.browser?t=!1:translate.request.post(translate.request.api.ip,{},e=>{if(e.result!==0){this.lang.browser=e.language,t=!1;return}console.log("Can not get the language by ip",e.info)}),new Promise(e=>{let a=setInterval(()=>{t||(clearInterval(a),e(this.lang.browser))},100)})}autoSelectLocalLanguage(){if(!this.detectLocalLanguage)return;let t=this.getLangNameById(this.lang.browser),e=this.getLangCodeById(this.lang.browser),a=localStorage.getItem("AutoTranslate_detected");if(t&&!this.hugoLangCodes.includes(e)&&this.languages.length&&!this.languages.includes(this.lang.browser)){this.languages.push(this.lang.browser),this.dom.localItem=document.createElement("li"),this.dom.localItem.classList.add("menu-item"),this.dom.localItem.dataset.type="machine",this.dom.localItem.innerHTML=`<a data-lang="${this.lang.browser}" class="menu-link" title="${t}"><i class="fa-solid fa-robot fa-fw fa-sm" aria-hidden="true"></i> ${t}</a>`,a!=="true"&&(translate.language.setDefaultTo(this.lang.browser),localStorage.setItem("AutoTranslate_detected",!0));return}a!=="true"&&this.hugoLangCodes.includes(e)&&!window.location.pathname.includes(this.hugoLangMap[e])&&(window.location=this.hugoLangMap[e]),a!=="true"&&localStorage.setItem("AutoTranslate_detected",!0)}clearCache(){localStorage.removeItem("AutoTranslate_detected"),translate.language.clearCacheLanguage()}init(){this.getBrowserLanguage().then(t=>{this.autoSelectLocalLanguage(),this.setup(),this.handle(),this.execute()})}};fixit.autoTranslate=new l;document.readyState!=="loading"?fixit.autoTranslate.init():document.addEventListener("DOMContentLoaded",()=>fixit.autoTranslate.init(),!1);})();
